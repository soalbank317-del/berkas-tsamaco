<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>TSAMACO - Arsip File</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f0f4f8; --card:#ffffff; --accent:#1e88e5; --accent-dark:#1565c0;
  --muted:#666; --text:#222; --highlight:#fff59d;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  background:var(--bg);
  min-height:100vh;
  display:flex; justify-content:center; padding:28px;
}
.wrap{
  width:100%; max-width:1100px;
  background:var(--card); border-radius:20px; padding:32px;
  box-shadow:0 12px 40px rgba(0,0,0,0.08);
  display:flex; flex-direction:column; align-items:center;
}
.head{text-align:center; margin-bottom:24px;}
.logo{
  width:80px; height:80px; border-radius:16px;
  background:linear-gradient(135deg,var(--accent),var(--accent-dark));
  display:flex; align-items:center; justify-content:center;
  color:white; font-size:36px; margin:0 auto 12px auto;
  box-shadow:0 8px 20px rgba(30,136,229,0.25);
  font-weight:700;
}
h1{ font-size:24px; letter-spacing:1px; color:var(--text); text-transform:uppercase; margin-bottom:6px;}
.sub{ color:var(--muted); font-size:15px; margin-bottom:16px;}
.controls{
  width:100%; max-width:500px; margin-bottom:16px;
}
.controls input{
  width:100%; padding:12px 16px; border-radius:12px; border:2px solid var(--accent);
  outline:none; font-size:14px; transition:0.25s;
}
.controls input:focus{ border-color:var(--accent-dark); box-shadow:0 4px 20px rgba(30,136,229,0.2);}
.results{
  width:100%; display:grid; grid-template-columns:1fr; gap:16px; transition: all 0.3s ease;
}
@media(min-width:700px){ .results{ grid-template-columns:repeat(2,1fr);} }
@media(min-width:1000px){ .results{ grid-template-columns:repeat(3,1fr);} }

.card{
  border-radius:16px; padding:20px;
  background:linear-gradient(135deg,#ffffff,#f7f9fc);
  box-shadow:0 8px 24px rgba(0,0,0,0.05);
  transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
  display:flex; flex-direction:column;
}
.card:hover{ transform:translateY(-8px) scale(1.03); box-shadow:0 20px 50px rgba(0,0,0,0.15);}
.card .top{ display:flex; gap:16px; align-items:center; }
.symbol{
  width:60px; height:60px; border-radius:12px;
  display:flex; align-items:center; justify-content:center;
  font-size:28px; background:#eef5fc; color:var(--accent);
  box-shadow:inset 0 -6px 24px rgba(0,0,0,0.02);
  transition: transform 0.4s ease;
}
.card:hover .symbol{ transform:translateY(-6px) scale(1.2) rotate(-10deg); }
.meta{ flex:1; display:flex; flex-direction:column; gap:4px;}
.mapel{ font-weight:600; color:var(--text); font-size:16px; }
.badges{ display:flex; gap:8px; flex-wrap:wrap; }
.badge{
  background:var(--accent); color:white; font-size:12px; font-weight:500;
  padding:2px 8px; border-radius:8px;
}
.card .actions{ margin-top:14px; display:flex; justify-content:flex-end;}
.btn.open{
  display:inline-block; padding:8px 14px; border-radius:12px; border:0;
  background:var(--accent); color:white; font-weight:600; text-decoration:none;
  transition:0.2s;
}
.btn.open:hover{ background:var(--accent-dark); }
.empty{ text-align:center;color:var(--muted); padding:36px 0; font-size:16px; }
mark.hi{ background:var(--highlight); padding:0 .15em; border-radius:4px;}
footer{ margin-top:28px; text-align:center; color:var(--muted); font-size:13px;}
</style>
</head>
<body>
<div class="wrap">
  <div class="head">
    <div class="logo">TA</div>
    <h1>TSAMACO</h1>
    <div class="sub">Arsip MTs Amtsilati - Persiapan Tsamaco</div>
  </div>

  <div class="controls">
    <input id="q" placeholder="Cari nama file...">
  </div>

  <div id="results" class="results" aria-live="polite"></div>
  <footer id="footer">@pacegondes <strong>2025</strong></footer>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT1s3KCGJWMcqWQkTppTXiuZMxxFUPJVLIxttNtOFRg2tzDT7kDeWxOyVofc8Fa7-PAQj8IiLD_S1Sw/pub?output=csv";
let all = [];

function parseCSV(text){
  const rows = text.split(/\r?\n/).filter(r=>r.trim()!=="");
  if(!rows.length) return [];
  const header = rows.shift().split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(h=>h.trim().toLowerCase());
  const idx = {
    nama: header.indexOf("nama file"),
    link: header.indexOf("link file"),
    ikon: header.indexOf("ikon"),
    size: header.indexOf("ukuran"),
    date: header.indexOf("tanggal"),
    cat: header.indexOf("kategori")
  };
  return rows.map(line=>{
    const cols = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c=>c.replace(/^"|"$/g,'').trim());
    return {
      nama: cols[idx.nama] || "Untitled",
      link: cols[idx.link] || "#",
      ikon: cols[idx.ikon] || "",
      size: cols[idx.size] || "-",
      date: cols[idx.date] || "-",
      category: cols[idx.cat] || "-"
    };
  });
}

const FILE_ICONS = { pdf:"📄", doc:"📄", docx:"📄", xls:"📊", xlsx:"📊", zip:"🗜️", ppt:"📈" };

function detectIcon(name,csvIcon){
  if(csvIcon && csvIcon.trim()) return csvIcon.trim();
  const ext = name.split('.').pop().toLowerCase();
  return FILE_ICONS[ext] || "⭐";
}

function highlight(text,q){
  if(!q) return text;
  const esc = q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
  const re = new RegExp(esc,'ig');
  return text.replace(re, m=>`<mark class="hi">${m}</mark>`);
}

function escapeAttr(s){ return s?s.replace(/"/g,'&quot;'):''; }

function render(){
  const q = document.getElementById('q').value.trim().toLowerCase();
  const cont = document.getElementById('results');
  cont.innerHTML = "";

  const filtered = all.filter(f=>f.nama.toLowerCase().includes(q));

  if(!filtered.length){ cont.innerHTML='<div class="empty">Tidak ada file yang cocok.</div>'; return; }

  filtered.forEach(it=>{
    const icon = detectIcon(it.nama,it.ikon);
    const card = document.createElement('article');
    card.className='card';
    card.innerHTML = `
      <div class="top">
        <div class="symbol">${icon}</div>
        <div class="meta">
          <div class="mapel">${highlight(it.nama,q)}</div>
          <div class="badges">
            <span class="badge">${it.size}</span>
            <span class="badge">${it.date}</span>
            <span class="badge">${it.category}</span>
          </div>
        </div>
      </div>
      <div class="actions">
        <a class="btn open" href="${escapeAttr(it.link)}" target="_blank" rel="noopener">Buka ↗</a>
      </div>
    `;
    cont.appendChild(card);
  });

  document.getElementById('footer').textContent = `Menampilkan ${filtered.length} file | @pacegondes 2025`;
}

async function load(){
  try{
    const res = await fetch(CSV_URL);
    if(!res.ok) throw new Error('Fetch error: '+res.status);
    const text = await res.text();
    all = parseCSV(text);
    all.sort((a,b)=>a.nama.localeCompare(b.nama));
    render();
  }catch(err){
    document.getElementById('results').innerHTML=`<div class="empty">Gagal mengambil data: ${err.message}</div>`;
    console.error(err);
  }
}

document.getElementById('q').addEventListener('input', render);
load();
</script>
</body>
</html>
